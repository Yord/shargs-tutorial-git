#!/usr/bin/env node

const {parserSync} = require('shargs')
const {command, flag, string, subcommand, variadicPos} = require('shargs-opts')
const {flagAsNumber, flagsAsBools, splitShortOpts} = require('shargs-parser')
const {optsList} = require('shargs-usage')

const init = subcommand([
  flag('quiet', ['-q', '--quiet'])
])

const commit = subcommand([
  flag('all', ['-a', '--all']),
  string('message', ['-m', '--message']),
  variadicPos('file')
])

const opts = [
  flag('help', ['--help']),
  init('init', ['init']),
  commit('commit', ['commit'])
]

const git    = command('git', opts)

const stages = {
  argv: [splitShortOpts],
  args: [flagAsNumber('quiet'), flagsAsBools]
}

const parser = parserSync(stages)
const parse  = parser(git)

const argv   = process.argv.slice(2)
const res    = parse(argv)

if (res.args.help) {
  const help = optsList(git)()
  console.log(help)
} else {
  console.log(JSON.stringify(res, null, 2))
}